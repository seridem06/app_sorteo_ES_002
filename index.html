<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sorteo dE SALIDAS</title>
    
    <link rel="stylesheet" href="styles.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
    <h2>Programa de Sorteo </h2>
    
    <div class="contenedor-maestro">
        <div class="columna-control">
            <div class="panel-gris">
                <span class="label-input">CANTIDAD A SORTEAR (VILLA):</span>
                <input type="number" id="input-limite" value="5" min="1" oninput="calcularTotalUnidades()">
                <span class="label-input">LISTA DE CÃ“DIGOS:</span>
                <textarea id="lista-izq" class="textarea-lista" oninput="calcularTotalUnidades()"></textarea>
                <div id="status-izq" class="status-text">LISTO</div>
                <button id="btn-iniciar" class="btn-azul" onclick="iniciarSecuenciaCompleta()">SORTEAR 1 (VILLA)</button>
                <button id="btn-reset" class="btn-rojo" onclick="resetearTodo()">RESETEAR SISTEMA</button>
            </div>
            <div class="visor-animacion" id="visor-izq"></div>
            <div class="panel-config">
                <div style="text-align: center; font-weight: bold; font-size: 12px; text-decoration: underline; margin-bottom:5px;">HORARIO VILLA</div>
                <div style="display: flex; gap: 5px;">
                    <div style="flex: 1;"><div class="label-small">INICIO</div><input type="time" id="input-hora-inicio" class="input-config" value="05:48"></div>
                    <div style="flex: 1;"><div class="label-small">INT (m)</div><input type="number" id="input-minutos" class="input-config" value="14" min="1"></div>
                </div>
                <button class="btn-gris-oscuro" onclick="generarNuevoHorarioVilla()">APLICAR CAMBIOS</button>
                <div id="msg-horario" style="font-size: 10px; color: green; text-align: center; height: 12px;"></div>
            </div>
            <div class="panel-contador">
                <div style="font-weight: bold; font-size: 12px;">UNIDADES SORTEADAS</div>
                <div id="contador-global" class="numero-contador">0</div>
            </div>
        </div>

        <div class="columna-villa">
            <div class="titulo-lista">VILLA</div>
            <ul id="lista-villa"></ul>
        </div>

        <div class="columna-tabla">
            <div class="header-tabla">RUTA D</div>
            <div class="tabla-contenedor">
                <table id="tabla-rutad"><tbody id="body-tabla"></tbody></table>
            </div>
            <button class="btn-whatsapp" onclick="generarReporteImagen()">ðŸ“¸ DESCARGAR REPORTE</button>
        </div>

        <div class="columna-derecha">
            <div class="panel-gris panel-derecho">
                <div>
                    <span class="label-input">SORTEO PRINCIPAL (RUTA D):</span>
                    <textarea id="lista-der" class="textarea-lista" style="height: 150px;" placeholder="Excedentes aquÃ­..." oninput="calcularTotalUnidades()"></textarea>
                </div>
                <div style="display: flex; flex-direction: column; gap: 10px; align-items: center;">
                    <div id="status-der" class="status-text" style="font-size: 12px;">EN ESPERA...</div>
                    <div class="visor-animacion" id="visor-der"></div>
                </div>
            </div>

            <div class="panel-multirango">
                <div class="titulo-multi">Configurar Horario (Rutas Intercaladas)</div>
                <div id="info-demanda" class="info-demanda">Total Unidades: 0</div>
                <div class="label-small">Â¿CuÃ¡ntos rangos base usar?</div>
                <select id="sel-num-rangos" class="selector-cantidad" onchange="actualizarRangosVisibles()">
                    <option value="1">1 Rango</option>
                    <option value="2">2 Rangos</option>
                    <option value="3">3 Rangos</option>
                    <option value="4" selected>4 Rangos</option>
                </select>
                <div style="display: grid; grid-template-columns: 0.4fr 1fr 1fr 0.8fr 1.2fr; gap:5px; text-align: center; font-size: 10px; font-weight: bold; margin-bottom:5px;">
                    <div>#</div> <div>INICIO</div> <div>FIN</div> <div>FREC</div> <div>TIPO</div>
                </div>
                <div class="fila-rango" id="fila-r1"><div class="lbl-fila">1</div><input type="time" id="r1-ini" class="input-rango" value="05:00"><input type="time" id="r1-fin" class="input-rango" value="06:00" onchange="sincronizarHoras()"><input type="number" id="r1-frec" class="input-rango" value="10"><select id="r1-tipo" class="input-rango"><option value="INTERCALADO">V/D</option><option value="VILLA">Villa</option><option value="D">D</option></select></div>
                <div class="fila-rango" id="fila-r2"><div class="lbl-fila">2</div><input type="time" id="r2-ini" class="input-rango input-auto" value="06:00" readonly><input type="time" id="r2-fin" class="input-rango" value="07:00" onchange="sincronizarHoras()"><input type="number" id="r2-frec" class="input-rango" value="10"><select id="r2-tipo" class="input-rango"><option value="INTERCALADO">V/D</option><option value="VILLA">Villa</option><option value="D">D</option></select></div>
                <div class="fila-rango" id="fila-r3"><div class="lbl-fila">3</div><input type="time" id="r3-ini" class="input-rango input-auto" value="07:00" readonly><input type="time" id="r3-fin" class="input-rango" value="09:00" onchange="sincronizarHoras()"><input type="number" id="r3-frec" class="input-rango" value="10"><select id="r3-tipo" class="input-rango"><option value="INTERCALADO">V/D</option><option value="VILLA">Villa</option><option value="D">D</option></select></div>
                <div class="fila-rango" id="fila-r4"><div class="lbl-fila">4</div><input type="time" id="r4-ini" class="input-rango input-auto" value="09:00" readonly><input type="time" id="r4-fin" class="input-rango" value="11:00"><input type="number" id="r4-frec" class="input-rango" value="10"><select id="r4-tipo" class="input-rango"><option value="INTERCALADO">V/D</option><option value="VILLA">Villa</option><option value="D">D</option></select></div>
                
                <div style="margin-top:15px; border-top:1px dashed #2196f3; padding-top:10px; text-align:center;">
                    <div class="label-small" style="color:#1565c0; margin-bottom:5px;">INICIO BLOQUEO (Cuadros Verdes)</div>
                    <input type="time" id="input-hora-bloqueo" class="input-rango" style="width:100px; font-weight:bold; color:#198754; border:2px solid #198754;" value="07:25">
                </div>
                
                <button class="btn-verde-gen" onclick="generarHorarioPorDemanda()">RE-GENERAR TABLA</button>
                <button class="btn-naranja" onclick="limpiarTablaD()">LIMPIAR TABLA</button>
            </div>
        </div>
    </div>

    <div id="hoja-captura-oculta">
        <div class="reporte-header">
            <h1 class="reporte-titulo">REPORTE OFICIAL DE SALIDAS</h1>
            <div class="reporte-info-grid">
                <div>FRECUENCIA VILLA: <span id="rep-frec-villa" class="reporte-dato">--</span> min</div>
                <div>TOTAL UNIDADES: <span id="rep-total" class="reporte-dato">--</span></div>
                <div>FECHA: <span class="reporte-dato" id="rep-fecha">HOY</span></div>
            </div>
        </div>
        <div class="reporte-cuerpo">
            <div class="reporte-col-villa">
                <div class="reporte-subtitulo">VILLA</div>
                <ul id="lista-villa-reporte"></ul>
            </div>
            <div class="reporte-col-rutad">
                <div class="reporte-subtitulo">RUTA D</div>
                <table id="tabla-rutad-reporte"><tbody id="body-tabla-reporte"></tbody></table>
            </div>
        </div>
        <div class="reporte-footer">
            <p class="texto-multa">ADVERTENCIA: CUMPLIR HORARIO ESTRICTAMENTE</p>
        </div>
    </div>

    <footer>
        <p>&copy; 2025 Derechos Reservados - Frank Oviedo</p>
    </footer>
    <script src="script.js"></script>
    <script src="sorteo-forzado.js"></script>
    
</body>
</html>